<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8">
  <title>Trang chủ</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"></script>
  <link rel="stylesheet" type="text/css" href="style.css">
</head>

<body>
  <div id="backgroundContainer" class="container-fluid p-0">
    <div class="upload-section d-flex flex-column align-items-start">
      <div class="upload-buttons">
        <input type="file" id="imageUpload" hidden>
        <button id="changeBackground" class="d-none upload-button fw-bold text-dark">CHỌN HÌNH NỀN MỚI</button>
        <input type="file" id="newBackgroundImage" style="display: none;">
        <label for="imageUpload" class="upload-button fw-bold text-dark">CHỌN ẢNH</label>
        <button class="upload-submit fw-bold text-dark" onclick="handleUpload()">UPLOAD</button>
      </div>
      <div class="selected-image">
        <span class="path">Chưa chọn ảnh</span>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script>
    const API_NAME = "NDPSO1";
    const API_KEY = "1WjiFJ51WBVtW1Bj3cemLcy8";
    async function handleUpload()
    {
      const fileInput = document.getElementById('imageUpload');
      const uploadButton = document.querySelector('.upload-submit');

      const containerHeight = window.innerHeight;
      const backgroundImage = new Image();
      backgroundImage.src = '1.jpg';
      backgroundImage.onload = () =>
      {
        const imageAspectRatio = backgroundImage.width / backgroundImage.height;
        backgroundImage.width = containerHeight * imageAspectRatio;
        backgroundImage.height = containerHeight;
      };

      uploadButton.disabled = true;
      uploadButton.textContent = 'Đang xử lý...';

      const file = fileInput.files[0];
      const formData = new FormData();
      formData.append('size', 'auto');
      formData.append('image_file', file);

      try
      {
        const response = await fetch('https://api.remove.bg/v1.0/removebg', {
          method: 'POST',
          headers: {
            'X-Api-Key': API_KEY
          },
          body: formData
        });


        const processedImageURL = URL.createObjectURL(await response.blob());
        const processedImage = new Image();

        processedImage.onload = function ()
        {
          var processedImageWidth = 400;
          var processedImageHeight = 600;
          var processedImageX = backgroundImage.naturalWidth / 2 + processedImageWidth / 2;
          var processedImageY = backgroundImage.naturalHeight - processedImageHeight;

          const canvas = document.createElement('canvas');
          canvas.width = backgroundImage.naturalWidth;
          canvas.height = backgroundImage.naturalHeight;

          const ctx = canvas.getContext('2d');
          ctx.drawImage(backgroundImage, 0, 0);
          ctx.drawImage(processedImage, processedImageX, processedImageY, processedImageWidth, processedImageHeight);

          backgroundImage.src = canvas.toDataURL('image/jpeg');

          URL.revokeObjectURL(processedImageURL);

          uploadButton.disabled = false;
          uploadButton.textContent = 'UPLOAD';
        };

        processedImage.src = processedImageURL;

        uploadButton.disabled = false;
        uploadButton.textContent = 'UPLOAD';
      } catch (error)
      {
        console.error(error);

        uploadButton.disabled = false;
        uploadButton.textContent = 'UPLOAD';
      }
    }

    const button = document.getElementById('changeBackground');
    const fileInput = document.getElementById('newBackgroundImage');

    button.addEventListener('click', function ()
    {
      fileInput.click();
    });

    fileInput.addEventListener('change', function ()
    {
      const file = this.files[0];
      const reader = new FileReader();

      reader.onload = function (e)
      {
        const backgroundContainer = document.getElementById('backgroundContainer');
        console.log(e.target.result);
        backgroundContainer.style.backgroundImage = `url(${e.target.result})`;
      }

      reader.readAsDataURL(file);
    });
  </script>
</body>

</html>